/**
 * MorphoNews Feature: エージェンティック・コグニティブ・フロー・ビジュアライザー
 * Generated: 2026-01-17_0959
 * Description: ユーザーの閲覧履歴と滞在時間を解析し、情報の「進化の軌跡」をページ上に有機的な流体ラインとして可視化します。どのニュースからどの知識へ遷移したかの認知的フローを動的に描画します。
 */
(function() { const style = document.createElement('style'); style.textContent = `.cog-flow-svg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; opacity: 0.6; filter: blur(1px); } .cog-flow-node { fill: #00ffcc; filter: drop-shadow(0 0 5px #00ffcc); transition: r 0.3s ease; } .cog-flow-path { fill: none; stroke: url(#flow-gradient); stroke-width: 3; stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: flow-dash 10s linear infinite; stroke-linecap: round; stroke-linejoin: round; } @keyframes flow-dash { to { stroke-dashoffset: 0; } } .cog-flow-indicator { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: #00ffcc; padding: 8px 12px; border-radius: 20px; font-family: monospace; font-size: 12px; border: 1px solid #00ffcc; z-index: 9999; pointer-events: none; }`; document.head.appendChild(style); const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'); svg.classList.add('cog-flow-svg'); const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs'); defs.innerHTML = `<linearGradient id="flow-gradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" style="stop-color:#00ffcc;stop-opacity:0" /><stop offset="50%" style="stop-color:#00ffcc;stop-opacity:1" /><stop offset="100%" style="stop-color:#3399ff;stop-opacity:0.8" /></linearGradient>`; svg.appendChild(defs); const path = document.createElementNS('http://www.w3.org/2000/svg', 'path'); path.classList.add('cog-flow-path'); svg.appendChild(path); document.body.appendChild(svg); const indicator = document.createElement('div'); indicator.classList.add('cog-flow-indicator'); indicator.textContent = 'COGNITIVE FLOW: EVOLVING...'; document.body.appendChild(indicator); let history = []; const maxNodes = 8; const updatePath = () => { if (history.length < 2) return; let d = `M ${history[0].x} ${history[0].y}`; for (let i = 1; i < history.length; i++) { const midX = (history[i-1].x + history[i].x) / 2; const midY = (history[i-1].y + history[i].y) / 2; d += ` Q ${history[i-1].x} ${history[i-1].y} ${midX} ${midY} T ${history[i].x} ${history[i].y}`; } path.setAttribute('d', d); }; const handleInteraction = (e) => { const target = e.target.closest('article, section, .news-renderer, [role="article"]'); if (!target) return; const rect = target.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; const now = Date.now(); if (history.length > 0) { const last = history[history.length - 1]; const dist = Math.sqrt(Math.pow(centerX - last.x, 2) + Math.pow(centerY - last.y, 2)); if (dist < 50) return; } history.push({ x: centerX, y: centerY, timestamp: now }); if (history.length > maxNodes) history.shift(); updatePath(); indicator.textContent = `COGNITIVE FLOW: ${history.length} NODES CONNECTED`; }; window.addEventListener('mouseover', handleInteraction); window.addEventListener('scroll', () => { const scrollDiff = window.scrollY - (window.lastScrollY || 0); history = history.map(node => ({ ...node, y: node.y - scrollDiff })); window.lastScrollY = window.scrollY; updatePath(); }, { passive: true }); })();
