/**
 * MorphoNews Feature: エージェンティック・コンテキスト・パーティクル・ブリッジ
 * Generated: 2026-01-22_0946
 * Description: ユーザーが記事間をスクロール移動する際、前の文脈の断片を「パーティクル（情報粒子）」として物理的に次のコンテンツへと運び込み、情報の連続性と認知的遷移を視覚的にサポートします。
 */
(function() { const style = document.createElement('style'); style.textContent = '#morpho-particle-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; }'; document.head.appendChild(style); const canvas = document.createElement('canvas'); canvas.id = 'morpho-particle-canvas'; document.body.appendChild(canvas); const ctx = canvas.getContext('2d'); let width, height; const resize = () => { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }; window.addEventListener('resize', resize); resize(); class Particle { constructor(x, y, text, direction) { this.x = x; this.y = y; this.text = text; this.vx = (Math.random() - 0.5) * 1.5; this.vy = direction > 0 ? Math.random() * 4 + 2 : -(Math.random() * 4 + 2); this.alpha = 1; this.life = 120; this.fontSize = Math.random() * 10 + 8; } draw() { ctx.fillStyle = `rgba(100, 255, 218, ${this.alpha})`; ctx.font = `${this.fontSize}px monospace`; ctx.fillText(this.text, this.x, this.y); } update() { this.x += this.vx; this.y += this.vy; this.alpha -= 0.008; this.life--; } } let particles = []; let lastScrollY = window.scrollY; const getSnippet = () => { const headings = Array.from(document.querySelectorAll('h1, h2, h3, p')); if (headings.length > 0) { const target = headings[Math.floor(Math.random() * headings.length)]; const words = target.innerText.trim().split(/\s+|\n/); return words[Math.floor(Math.random() * words.length)].substring(0, 8); } return 'DATA'; }; function animate() { ctx.clearRect(0, 0, width, height); particles = particles.filter(p => p.life > 0); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animate); } animate(); window.addEventListener('scroll', () => { const currentY = window.scrollY; const dy = currentY - lastScrollY; if (Math.abs(dy) > 15) { const direction = dy > 0 ? 1 : -1; for (let i = 0; i < 2; i++) { const x = Math.random() * width; const y = direction > 0 ? 0 : height; particles.push(new Particle(x, y, getSnippet(), direction)); } } lastScrollY = currentY; }, { passive: true }); })();
