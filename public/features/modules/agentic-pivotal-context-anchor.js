/**
 * MorphoNews Feature: エージェンティック・ピボタル・コンテクスト・アンカー
 * Generated: 2026-01-18_0033
 * Description: 読了中のセクションから「情報の旋回軸（ピボット）」となる重要文脈をリアルタイムで抽出し、画面端に固定表示します。スクロールにより視点が移動しても、現在の文脈の核心を常に視界に留め、理解の連続性を維持します。
 */
(function() { const id = 'agentic-pivotal-context-anchor'; if (document.getElementById(id)) return; const style = document.createElement('style'); style.innerHTML = ` #${id} { position: fixed; bottom: 30px; right: 30px; width: 250px; background: rgba(12, 16, 23, 0.95); color: #00f2ff; padding: 18px; border-radius: 2px; border-right: 4px solid #00f2ff; font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; font-size: 11px; z-index: 10000; box-shadow: -10px 10px 30px rgba(0,0,0,0.6); pointer-events: none; transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1); border-top: 1px solid rgba(255,255,255,0.1); } #${id} .pivot-header { font-weight: 900; font-size: 10px; letter-spacing: 2px; margin-bottom: 10px; color: #5c6b73; display: flex; justify-content: space-between; align-items: center; } #${id} .pivot-header::before { content: ''; width: 6px; height: 6px; background: #00f2ff; border-radius: 50%; box-shadow: 0 0 8px #00f2ff; } #${id} #pivot-body { line-height: 1.7; color: #e0e0e0; font-style: normal; opacity: 0.9; } .pivot-active-node { transition: border-right 0.4s ease; border-right: 4px solid #00f2ff !important; padding-right: 15px !important; } `; document.head.appendChild(style); const el = document.createElement('div'); el.id = id; el.innerHTML = '<div class="pivot-header"><span>PIVOTAL CONTEXT</span></div><div id="pivot-body">Analyzing flow...</div>'; document.body.appendChild(el); let lastNode = null; const obs = new IntersectionObserver((entries) => { entries.forEach(e => { if (e.isIntersecting) { if (lastNode) lastNode.classList.remove('pivot-active-node'); lastNode = e.target; lastNode.classList.add('pivot-active-node'); let text = e.target.innerText.trim(); let pivotalSentence = text.split(/[。！？\n]/).filter(s => s.length > 5)[0] || text; document.getElementById('pivot-body').innerText = pivotalSentence.substring(0, 100) + (pivotalSentence.length > 100 ? '...' : ''); el.style.transform = 'translateX(0)'; el.style.opacity = '1'; } }); }, { threshold: 0.6, rootMargin: '-10% 0px -40% 0px' }); const scan = () => { document.querySelectorAll('p, h2, h3, blockquote').forEach(n => { if (n.innerText.length > 40) obs.observe(n); }); }; scan(); const mo = new MutationObserver(scan); mo.observe(document.body, { childList: true, subtree: true }); })();
