<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MorphoNews | Ë®≠ÂÆö</title>
    <meta name="description" content="MorphoNews„ÅÆË®≠ÂÆö„Éö„Éº„Ç∏„ÄÇÊ©üËÉΩ„ÅÆON/OFF„ÄÅ„ÉÜ„Éº„ÉûÈÅ∏Êäû„Å™„Å©„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åß„Åç„Åæ„Åô„ÄÇ">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Base Styles -->
    <link rel="stylesheet" href="./styles/base.css">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .page-title {
            text-align: center;
            margin-bottom: 2rem;
        }

        .page-title h1 {
            font-size: 2rem;
            background: var(--morpho-accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .page-title p {
            color: var(--morpho-text-secondary);
            margin-top: 0.5rem;
        }

        .settings-section {
            background: var(--morpho-bg-card);
            border: 1px solid var(--morpho-border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--morpho-border-color);
        }

        .section-header h2 {
            font-size: 1.2rem;
            color: var(--morpho-text-primary);
        }

        .section-header i {
            color: var(--morpho-accent-primary);
        }

        /* Feature Toggle */
        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .feature-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--morpho-bg-primary);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .feature-item:hover {
            background: color-mix(in srgb, var(--morpho-accent-primary) 5%, var(--morpho-bg-primary));
        }

        .feature-info {
            flex: 1;
        }

        .feature-name {
            font-weight: 600;
            color: var(--morpho-text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-name .badge {
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            background: var(--morpho-accent-gradient);
            color: white;
            font-weight: 500;
        }

        .feature-description {
            font-size: 0.85rem;
            color: var(--morpho-text-secondary);
            margin-top: 0.25rem;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--morpho-border-color);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch input:checked+.toggle-slider {
            background: var(--morpho-accent-gradient);
        }

        .toggle-switch input:checked+.toggle-slider::before {
            transform: translateX(24px);
        }

        .toggle-switch input:disabled+.toggle-slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Theme Grid */
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }

        .theme-card {
            border: 2px solid var(--morpho-border-color);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .theme-card:hover {
            border-color: var(--morpho-accent-primary);
            transform: translateY(-2px);
        }

        .theme-card.active {
            border-color: var(--morpho-accent-primary);
            background: color-mix(in srgb, var(--morpho-accent-primary) 5%, var(--morpho-bg-card));
        }

        .theme-preview {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin-bottom: 0.75rem;
        }

        .theme-color {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .theme-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--morpho-text-primary);
        }

        .theme-description {
            font-size: 0.75rem;
            color: var(--morpho-text-secondary);
            margin-top: 0.25rem;
        }

        /* Save Button */
        .save-section {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn-save {
            background: var(--morpho-accent-gradient);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .btn-save:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px color-mix(in srgb, var(--morpho-accent-primary) 30%, transparent);
        }

        .btn-reset {
            background: transparent;
            color: var(--morpho-text-secondary);
            border: 1px solid var(--morpho-border-color);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-reset:hover {
            background: var(--morpho-bg-primary);
            color: var(--morpho-text-primary);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--morpho-text-primary);
            color: var(--morpho-bg-primary);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .stat-card {
            background: var(--morpho-bg-primary);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--morpho-accent-primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--morpho-text-secondary);
            margin-top: 0.25rem;
        }

        /* Hamburger Menu */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            padding: 8px;
            cursor: pointer;
            background: none;
            border: none;
        }

        .hamburger span {
            display: block;
            width: 24px;
            height: 2px;
            background: var(--morpho-text-primary);
            transition: all 0.3s ease;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        /* Mobile Menu */
        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--morpho-bg-secondary);
            z-index: 999;
            padding: 80px 24px 24px;
            flex-direction: column;
            gap: 1rem;
        }

        .mobile-menu.show {
            display: flex;
        }

        .mobile-menu a {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            border-radius: 12px;
            color: var(--morpho-text-primary);
            font-size: 1.1rem;
            transition: all 0.2s ease;
        }

        .mobile-menu a:hover {
            background: var(--morpho-bg-primary);
        }

        .mobile-menu a.active {
            background: var(--morpho-accent-gradient);
            color: white;
        }

        @media (max-width: 768px) {
            .settings-container {
                padding: 1rem;
            }

            .morpho-nav {
                display: none;
            }

            .hamburger {
                display: flex;
            }

            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .feature-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .toggle-switch {
                align-self: flex-end;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="morpho-header">
        <div class="morpho-header-content">
            <div class="morpho-logo">
                <h1>ü¶ã MorphoNews</h1>
                <span>Settings</span>
            </div>
            <nav class="morpho-nav">
                <a href="./index.html">
                    <i data-lucide="home" style="width: 18px; height: 18px;"></i>
                    ÊúÄÊñ∞
                </a>
                <a href="./history.html">
                    <i data-lucide="archive" style="width: 18px; height: 18px;"></i>
                    „Ç¢„Éº„Ç´„Ç§„Éñ
                </a>
                <a href="./settings.html" class="active"
                    style="background: var(--morpho-accent-gradient); color: white;">
                    <i data-lucide="settings" style="width: 18px; height: 18px;"></i>
                    Ë®≠ÂÆö
                </a>
            </nav>
            <button class="hamburger" id="hamburger" aria-label="„É°„Éã„É•„Éº">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobileMenu">
        <a href="./index.html">
            <i data-lucide="home" style="width: 24px; height: 24px;"></i>
            ÊúÄÊñ∞„ÅÆ„Éã„É•„Éº„Çπ
        </a>
        <a href="./history.html">
            <i data-lucide="archive" style="width: 24px; height: 24px;"></i>
            „Ç¢„Éº„Ç´„Ç§„Éñ
        </a>
        <a href="./settings.html" class="active">
            <i data-lucide="settings" style="width: 24px; height: 24px;"></i>
            Ë®≠ÂÆö
        </a>
    </nav>

    <main class="settings-container">
        <div class="page-title">
            <h1>
                <i data-lucide="settings" style="width: 32px; height: 32px;"></i>
                Ë®≠ÂÆö
            </h1>
            <p>MorphoNews„ÅÆÊ©üËÉΩ„Å®„Çπ„Çø„Ç§„É´„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫</p>
        </div>

        <!-- Features Section -->
        <section class="settings-section">
            <div class="section-header">
                <i data-lucide="puzzle" style="width: 24px; height: 24px;"></i>
                <h2>Ê©üËÉΩ„ÅÆÊúâÂäπÂåñ/ÁÑ°ÂäπÂåñ</h2>
            </div>
            <div class="feature-list" id="featureList">
                <!-- JavaScript „ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                <div style="text-align: center; padding: 2rem; color: var(--morpho-text-secondary);">
                    <i data-lucide="loader" style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                    <p>Ê©üËÉΩ„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
            </div>
        </section>

        <!-- Theme Section -->
        <section class="settings-section">
            <div class="section-header">
                <i data-lucide="palette" style="width: 24px; height: 24px;"></i>
                <h2>„ÉÜ„Éº„Éû„ÇíÈÅ∏Êäû</h2>
            </div>
            <div class="theme-grid" id="themeGrid">
                <!-- JavaScript „ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                <div
                    style="text-align: center; padding: 2rem; color: var(--morpho-text-secondary); grid-column: 1 / -1;">
                    <i data-lucide="loader" style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                    <p>„ÉÜ„Éº„Éû„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                </div>
            </div>
        </section>

        <!-- Stats Section -->
        <section class="settings-section">
            <div class="section-header">
                <i data-lucide="bar-chart-2" style="width: 24px; height: 24px;"></i>
                <h2>Áµ±Ë®àÊÉÖÂ†±</h2>
            </div>
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-value" id="statFeatures">-</div>
                    <div class="stat-label">ÁôªÈå≤Ê©üËÉΩ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statThemes">-</div>
                    <div class="stat-label">„ÉÜ„Éº„Éû</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statArchives">-</div>
                    <div class="stat-label">„Ç¢„Éº„Ç´„Ç§„Éñ</div>
                </div>
            </div>
        </section>

        <!-- Save Section -->
        <div class="save-section">
            <button class="btn-reset" id="btnReset">
                <i data-lucide="rotate-ccw" style="width: 18px; height: 18px;"></i>
                „É™„Çª„ÉÉ„Éà
            </button>
            <button class="btn-save" id="btnSave">
                <i data-lucide="save" style="width: 18px; height: 18px;"></i>
                Ë®≠ÂÆö„Çí‰øùÂ≠ò
            </button>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
        <span id="toastMessage">Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü</span>
    </div>

    <script>
        // Settings Manager
        class SettingsManager {
            constructor() {
                this.features = [];
                this.themes = [];
                this.settings = this.loadSettings();
                this.currentTheme = this.settings.theme || 'default';
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('morpho-settings');
                    return saved ? JSON.parse(saved) : { features: {}, theme: 'default' };
                } catch {
                    return { features: {}, theme: 'default' };
                }
            }

            saveSettings() {
                localStorage.setItem('morpho-settings', JSON.stringify(this.settings));
                localStorage.setItem('morpho-theme', this.currentTheme);
            }

            async init() {
                await this.loadFeatures();
                await this.loadThemes();
                await this.loadStats();
                this.renderFeatures();
                this.renderThemes();
                this.applyTheme(this.currentTheme);
                this.bindEvents();
            }

            async loadFeatures() {
                try {
                    const response = await fetch('./features/features.json');
                    const data = await response.json();
                    this.features = data.features || [];
                } catch (error) {
                    console.error('Failed to load features:', error);
                    this.features = [];
                }
            }

            async loadThemes() {
                try {
                    const response = await fetch('./styles/styles.json');
                    const data = await response.json();
                    this.themes = data.themes || [];
                } catch (error) {
                    console.error('Failed to load themes:', error);
                    this.themes = [];
                }
            }

            async loadStats() {
                try {
                    const response = await fetch('./history.json');
                    const data = await response.json();
                    document.getElementById('statArchives').textContent = (data.entries || []).length;
                } catch {
                    document.getElementById('statArchives').textContent = '-';
                }

                document.getElementById('statFeatures').textContent = this.features.length;
                document.getElementById('statThemes').textContent = this.themes.length;
            }

            renderFeatures() {
                const container = document.getElementById('featureList');

                if (this.features.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--morpho-text-secondary);">Ê©üËÉΩ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>';
                    return;
                }

                container.innerHTML = this.features.map(feature => {
                    const isEnabled = this.isFeatureEnabled(feature);
                    const isRequired = feature.required;

                    return `
            <div class="feature-item" data-feature-id="${feature.id}">
              <div class="feature-info">
                <div class="feature-name">
                  ${feature.name}
                  ${isRequired ? '<span class="badge">ÂøÖÈ†à</span>' : ''}
                  ${feature.author === 'ai' ? '<span class="badge" style="background: linear-gradient(135deg, #22c55e, #10b981);">AIÁîüÊàê</span>' : ''}
                </div>
                <div class="feature-description">${feature.description}</div>
              </div>
              <label class="toggle-switch">
                <input type="checkbox" 
                       data-feature-id="${feature.id}" 
                       ${isEnabled ? 'checked' : ''} 
                       ${isRequired ? 'disabled' : ''}>
                <span class="toggle-slider"></span>
              </label>
            </div>
          `;
                }).join('');
            }

            renderThemes() {
                const container = document.getElementById('themeGrid');

                if (this.themes.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--morpho-text-secondary); grid-column: 1 / -1;">„ÉÜ„Éº„Éû„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>';
                    return;
                }

                container.innerHTML = this.themes.map(theme => {
                    const isActive = theme.id === this.currentTheme;
                    const preview = theme.preview || {};

                    return `
            <div class="theme-card ${isActive ? 'active' : ''}" data-theme-id="${theme.id}">
              <div class="theme-preview">
                <div class="theme-color" style="background: ${preview.primary || '#6366f1'}"></div>
                <div class="theme-color" style="background: ${preview.secondary || '#8b5cf6'}"></div>
                <div class="theme-color" style="background: ${preview.background || '#f8fafc'}"></div>
              </div>
              <div class="theme-name">${theme.name}</div>
              <div class="theme-description">${theme.description?.substring(0, 30) || ''}...</div>
            </div>
          `;
                }).join('');
            }

            isFeatureEnabled(feature) {
                if (feature.required) return true;
                const setting = this.settings.features?.[feature.id];
                return setting !== undefined ? setting : feature.enabled;
            }

            applyTheme(themeId) {
                const existing = document.querySelector('link[href*="/styles/themes/"]');
                if (existing) {
                    existing.href = `./styles/themes/${themeId}.css`;
                }

                // Update active state
                document.querySelectorAll('.theme-card').forEach(card => {
                    card.classList.toggle('active', card.dataset.themeId === themeId);
                });
            }

            bindEvents() {
                // Theme selection
                document.getElementById('themeGrid').addEventListener('click', (e) => {
                    const card = e.target.closest('.theme-card');
                    if (card) {
                        this.currentTheme = card.dataset.themeId;
                        this.applyTheme(this.currentTheme);
                    }
                });

                // Feature toggles
                document.getElementById('featureList').addEventListener('change', (e) => {
                    if (e.target.type === 'checkbox') {
                        const featureId = e.target.dataset.featureId;
                        if (!this.settings.features) this.settings.features = {};
                        this.settings.features[featureId] = e.target.checked;
                    }
                });

                // Save button
                document.getElementById('btnSave').addEventListener('click', () => {
                    this.settings.theme = this.currentTheme;
                    this.saveSettings();
                    this.showToast('Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                });

                // Reset button
                document.getElementById('btnReset').addEventListener('click', () => {
                    if (confirm('Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                        localStorage.removeItem('morpho-settings');
                        localStorage.removeItem('morpho-theme');
                        this.settings = { features: {}, theme: 'default' };
                        this.currentTheme = 'default';
                        this.applyTheme('default');
                        this.renderFeatures();
                        this.renderThemes();
                        this.showToast('Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
                    }
                });

                // Hamburger menu
                const hamburger = document.getElementById('hamburger');
                const mobileMenu = document.getElementById('mobileMenu');

                hamburger.addEventListener('click', () => {
                    hamburger.classList.toggle('active');
                    mobileMenu.classList.toggle('show');
                    document.body.style.overflow = mobileMenu.classList.contains('show') ? 'hidden' : '';
                });
            }

            showToast(message) {
                const toast = document.getElementById('toast');
                document.getElementById('toastMessage').textContent = message;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Spin animation
        const style = document.createElement('style');
        style.textContent = '@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }';
        document.head.appendChild(style);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            const settings = new SettingsManager();
            settings.init();
        });
    </script>
</body>

</html>