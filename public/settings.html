<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MorphoNews | Ë®≠ÂÆö</title>
    <meta name="description" content="MorphoNews„ÅÆË®≠ÂÆö„Éö„Éº„Ç∏„ÄÇÊ©üËÉΩ„ÅÆON/OFF„ÄÅ„ÉÜ„Éº„ÉûÈÅ∏Êäû„Å™„Å©„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åß„Åç„Åæ„Åô„ÄÇ">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- Base Styles -->
    <link rel="stylesheet" href="./styles/base.css">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Layout Structure */
        .settings-layout {
            display: grid;
            grid-template-columns: 240px 1fr;
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            min-height: calc(100vh - 160px);
        }

        /* Sidebar Navigation */
        .settings-sidebar {
            position: sticky;
            top: 100px;
            height: fit-content;
        }

        .settings-nav {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            background: var(--morpho-bg-card);
            border: 1px solid var(--morpho-border-color);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: var(--morpho-shadow-sm);
        }

        .settings-nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            color: var(--morpho-text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .settings-nav-item:hover {
            background: var(--morpho-bg-primary);
            color: var(--morpho-text-primary);
        }

        .settings-nav-item.active {
            background: var(--morpho-accent-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .settings-main {
            flex: 1;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Sections */
        .settings-section {
            background: var(--morpho-bg-card);
            border: 1px solid var(--morpho-border-color);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--morpho-shadow-sm);
        }

        .section-info {
            margin-bottom: 2rem;
        }

        .section-info h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--morpho-text-primary);
        }

        .section-info p {
            color: var(--morpho-text-secondary);
            font-size: 0.95rem;
        }

        /* Search Bar */
        .search-container {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.85rem 1rem 0.85rem 2.75rem;
            background: var(--morpho-bg-primary);
            border: 1px solid var(--morpho-border-color);
            border-radius: 12px;
            color: var(--morpho-text-primary);
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--morpho-accent-primary);
            background: var(--morpho-bg-card);
            box-shadow: 0 0 0 3px color-mix(in srgb, var(--morpho-accent-primary) 15%, transparent);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--morpho-text-secondary);
        }

        /* Feature Styling */
        .feature-group {
            margin-bottom: 2rem;
        }

        .feature-group-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--morpho-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            padding-left: 0.75rem;
            border-left: 3px solid var(--morpho-accent-primary);
        }

        .feature-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .feature-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            background: var(--morpho-bg-primary);
            border: 1px solid var(--morpho-border-color);
            border-radius: 12px;
            transition: all 0.2s ease;
        }

        .feature-item:hover {
            border-color: var(--morpho-accent-primary);
            background: var(--morpho-bg-primary);
            transform: translateX(4px);
        }

        .feature-info {
            flex: 1;
        }

        .feature-name {
            font-weight: 700;
            color: var(--morpho-text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-description {
            font-size: 0.85rem;
            color: var(--morpho-text-secondary);
            margin-top: 0.25rem;
            line-height: 1.4;
        }

        .badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            background: var(--morpho-accent-gradient);
            color: white;
            font-weight: bold;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 52px;
            height: 28px;
            flex-shrink: 0;
            margin-left: 1rem;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--morpho-border-color);
            transition: 0.3s;
            border-radius: 28px;
        }

        .toggle-slider::before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .toggle-switch input:checked+.toggle-slider {
            background: var(--morpho-accent-primary);
        }

        .toggle-switch input:checked+.toggle-slider::before {
            transform: translateX(24px);
        }

        /* Theme & Layout Cards */
        .theme-grid,
        .layout-grid {
            display: grid;
            gap: 1.25rem;
        }

        .theme-grid {
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }

        .layout-grid {
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        }

        .theme-card,
        .layout-card {
            background: var(--morpho-bg-primary);
            border: 2px solid var(--morpho-border-color);
            border-radius: 14px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .theme-card:hover,
        .layout-card:hover {
            border-color: var(--morpho-accent-primary);
            transform: translateY(-4px);
            box-shadow: var(--morpho-shadow-md);
        }

        .theme-card.active,
        .layout-card.active {
            border-color: var(--morpho-accent-primary);
            background: var(--morpho-bg-card);
            box-shadow: var(--morpho-shadow-md);
        }

        .theme-card.active::after,
        .layout-card.active::after {
            content: "";
            position: absolute;
            top: -2px;
            right: -2px;
            width: 36px;
            height: 36px;
            background: var(--morpho-accent-gradient);
            clip-path: polygon(100% 0, 0 0, 100% 100%);
            border-radius: 0 14px 0 0;
        }

        .check-icon {
            position: absolute;
            top: 4px;
            right: 4px;
            color: white;
            z-index: 1;
        }

        /* Stats Tab */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--morpho-bg-primary);
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--morpho-border-color);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: scale(1.05);
            border-color: var(--morpho-accent-primary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--morpho-accent-primary);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.95rem;
            color: var(--morpho-text-secondary);
            margin-top: 0.75rem;
            font-weight: 500;
        }

        /* Toolbar */
        .settings-toolbar {
            position: fixed;
            bottom: 24px;
            right: 24px;
            display: flex;
            gap: 1rem;
            z-index: 1000;
            background: var(--morpho-bg-card);
            padding: 0.75rem 1.25rem;
            border-radius: 20px;
            border: 1px solid var(--morpho-border-color);
            box-shadow: var(--morpho-shadow-lg);
            backdrop-filter: blur(10px);
        }

        .btn-save,
        .btn-reset {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
        }

        .btn-save {
            background: var(--morpho-accent-gradient);
            color: white;
        }

        .btn-save:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-reset {
            background: var(--morpho-bg-primary);
            color: var(--morpho-text-secondary);
            border: 1px solid var(--morpho-border-color);
        }

        .btn-reset:hover {
            background: #fee2e2;
            color: #ef4444;
            border-color: #fca5a5;
        }

        /* Hamburger & Mobile Menu (Âæ©Êóß) */
        .hamburger {
            display: none;
            flex-direction: column;
            gap: 5px;
            padding: 8px;
            cursor: pointer;
            background: none;
            border: none;
            z-index: 1100;
        }

        .hamburger span {
            display: block;
            width: 24px;
            height: 2px;
            background: var(--morpho-text-primary);
            transition: 0.3s;
            border-radius: 2px;
        }

        .hamburger.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger.active span:nth-child(2) {
            opacity: 0;
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        .mobile-menu {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--morpho-bg-secondary);
            z-index: 1050;
            padding: 100px 2rem 2rem;
            flex-direction: column;
            gap: 1rem;
        }

        .mobile-menu.show {
            display: flex;
        }

        .mobile-menu a {
            padding: 1rem 1.5rem;
            border-radius: 12px;
            background: var(--morpho-bg-primary);
            color: var(--morpho-text-primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .mobile-menu a.active {
            background: var(--morpho-accent-gradient);
            color: white;
        }

        .toast {
            position: fixed;
            bottom: 32px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--morpho-text-primary);
            color: var(--morpho-bg-primary);
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-weight: 700;
            box-shadow: var(--morpho-shadow-lg);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Responsive Fixes */
        @media (max-width: 900px) {
            .settings-layout {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .settings-sidebar {
                position: static;
                margin-bottom: 1rem;
            }

            .settings-nav {
                flex-direction: row;
                overflow-x: auto;
                padding: 0.5rem;
                scrollbar-width: none;
            }

            .settings-nav::-webkit-scrollbar {
                display: none;
            }

            .settings-nav-item {
                padding: 0.6rem 1rem;
                white-space: nowrap;
            }

            .hamburger {
                display: flex;
            }

            .morpho-nav {
                display: none;
            }

            .settings-toolbar {
                left: 1rem;
                right: 1rem;
                justify-content: stretch;
            }

            .btn-save,
            .btn-reset {
                flex: 1;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="morpho-header">
        <div class="morpho-header-content">
            <div class="morpho-logo">
                <h1>ü¶ã MorphoNews</h1>
                <span>Settings</span>
            </div>
            <nav class="morpho-nav">
                <a href="./index.html">
                    <i data-lucide="home" style="width: 18px; height: 18px;"></i>
                    ÊúÄÊñ∞
                </a>
                <a href="./history.html">
                    <i data-lucide="archive" style="width: 18px; height: 18px;"></i>
                    „Ç¢„Éº„Ç´„Ç§„Éñ
                </a>
                <a href="./settings.html" class="active"
                    style="background: var(--morpho-accent-gradient); color: white;">
                    <i data-lucide="settings" style="width: 18px; height: 18px;"></i>
                    Ë®≠ÂÆö
                </a>
            </nav>
            <button class="hamburger" id="hamburger" aria-label="„É°„Éã„É•„Éº">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <nav class="mobile-menu" id="mobileMenu">
        <a href="./index.html">
            <i data-lucide="home" style="width: 24px; height: 24px;"></i>
            ÊúÄÊñ∞„ÅÆ„Éã„É•„Éº„Çπ
        </a>
        <a href="./history.html">
            <i data-lucide="archive" style="width: 24px; height: 24px;"></i>
            „Ç¢„Éº„Ç´„Ç§„Éñ
        </a>
        <a href="./settings.html" class="active">
            <i data-lucide="settings" style="width: 24px; height: 24px;"></i>
            Ë®≠ÂÆö
        </a>
    </nav>

    <div class="settings-layout">
        <!-- Sidebar Navigation -->
        <aside class="settings-sidebar">
            <nav class="settings-nav">
                <div class="settings-nav-item active" data-tab="features">
                    <i data-lucide="puzzle" style="width: 20px; height: 20px;"></i>
                    Ê©üËÉΩ
                </div>
                <div class="settings-nav-item" data-tab="layouts">
                    <i data-lucide="layout" style="width: 20px; height: 20px;"></i>
                    „É¨„Ç§„Ç¢„Ç¶„Éà
                </div>
                <div class="settings-nav-item" data-tab="themes">
                    <i data-lucide="palette" style="width: 20px; height: 20px;"></i>
                    „ÉÜ„Éº„Éû
                </div>
                <div class="settings-nav-item" data-tab="stats">
                    <i data-lucide="bar-chart-2" style="width: 20px; height: 20px;"></i>
                    Áµ±Ë®à„ÉªÊÉÖÂ†±
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="settings-main">
            <!-- Features Tab -->
            <div class="tab-content active" id="tab-features">
                <section class="settings-section">
                    <div class="section-info">
                        <h2>üß© Ê©üËÉΩ„ÅÆÁÆ°ÁêÜ</h2>
                        <p>ÁîüÊàê„Åï„Çå„ÅüÊ©üËÉΩ„ÇíON/OFF„Åó„Å¶ÊåôÂãï„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åß„Åç„Åæ„Åô„ÄÇ</p>
                    </div>

                    <div class="search-container">
                        <i data-lucide="search" class="search-icon" style="width: 18px; height: 18px;"></i>
                        <input type="text" class="search-input" id="featureSearch" placeholder="Ê©üËÉΩ„ÇíÊ§úÁ¥¢...">
                    </div>

                    <div class="feature-list" id="featureList">
                        <div style="text-align: center; padding: 2rem; color: var(--morpho-text-secondary);">
                            <i data-lucide="loader"
                                style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                            <p>Ê©üËÉΩ„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Layouts Tab -->
            <div class="tab-content" id="tab-layouts">
                <section class="settings-section">
                    <div class="section-info">
                        <h2>üìê „É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÈÅ∏Êäû</h2>
                        <p>AI„ÅåÁîüÊàê„Åó„ÅüÂ§öÂΩ©„Å™„Éö„Éº„Ç∏ÊßãÈÄ†„Åã„ÇâÈÅ©Áî®„Åô„Çã„ÇÇ„ÅÆ„ÇíÈÅ∏„Åπ„Åæ„Åô„ÄÇ</p>
                    </div>

                    <div class="layout-grid" id="layoutGrid">
                        <div
                            style="text-align: center; padding: 2rem; color: var(--morpho-text-secondary); grid-column: 1 / -1;">
                            <i data-lucide="loader"
                                style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                            <p>„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Themes Tab -->
            <div class="tab-content" id="tab-themes">
                <section class="settings-section">
                    <div class="section-info">
                        <h2>üé® „ÉÜ„Éº„Éû„ÇíÈÅ∏Êäû</h2>
                        <p>„Çµ„Ç§„Éà„ÅÆÈÖçËâ≤Ôºà„ÉÜ„Éº„ÉûÔºâ„ÇíËá™Áî±„Å´Â§âÊõ¥„Åß„Åç„Åæ„Åô„ÄÇ</p>
                    </div>

                    <div class="theme-grid" id="themeGrid">
                        <div
                            style="text-align: center; padding: 2rem; color: var(--morpho-text-secondary); grid-column: 1 / -1;">
                            <i data-lucide="loader"
                                style="width: 24px; height: 24px; animation: spin 1s linear infinite;"></i>
                            <p>„ÉÜ„Éº„Éû„ÇíË™≠„ÅøËæº„Åø‰∏≠...</p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Stats Tab -->
            <div class="tab-content" id="tab-stats">
                <section class="settings-section">
                    <div class="section-info">
                        <h2>üìä Áµ±Ë®à„Éª„Ç∑„Çπ„ÉÜ„É†ÊÉÖÂ†±</h2>
                        <p>„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅÆÈÄ≤ÂåñÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ</p>
                    </div>

                    <div class="stats-grid" id="statsGrid">
                        <div class="stat-card">
                            <div class="stat-value" id="statFeatures">-</div>
                            <div class="stat-label">ÁôªÈå≤Ê©üËÉΩ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statLayouts">-</div>
                            <div class="stat-label">„É¨„Ç§„Ç¢„Ç¶„Éà</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statThemes">-</div>
                            <div class="stat-label">„ÉÜ„Éº„Éû</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statArchives">-</div>
                            <div class="stat-label">„Ç¢„Éº„Ç´„Ç§„Éñ</div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Toolbar -->
    <div class="settings-toolbar">
        <button class="btn-reset" id="btnReset">
            <i data-lucide="rotate-ccw" style="width: 18px; height: 18px;"></i>
            „É™„Çª„ÉÉ„Éà
        </button>
        <button class="btn-save" id="btnSave">
            <i data-lucide="save" style="width: 18px; height: 18px;"></i>
            Ë®≠ÂÆö„Çí‰øùÂ≠ò
        </button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
        <span id="toastMessage">Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü</span>
    </div>

    <script>
        // Settings Manager
        class SettingsManager {
            constructor() {
                this.features = [];
                this.themes = [];
                this.layouts = [];
                this.settings = this.loadSettings();
                this.currentTheme = this.settings.theme || 'default';
                this.currentLayout = this.settings.layout || 'default';
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('morpho-settings');
                    const theme = localStorage.getItem('morpho-theme') || 'default';
                    const layout = localStorage.getItem('morpho-layout') || 'default';

                    const settings = saved ? JSON.parse(saved) : { features: {}, theme, layout };
                    settings.theme = settings.theme || theme;
                    settings.layout = settings.layout || layout;

                    return settings;
                } catch {
                    return { features: {}, theme: 'default', layout: 'default' };
                }
            }

            saveSettings() {
                localStorage.setItem('morpho-settings', JSON.stringify(this.settings));
                localStorage.setItem('morpho-theme', this.currentTheme);
                localStorage.setItem('morpho-layout', this.currentLayout);
            }

            async init() {
                await this.loadFeatures();
                await this.loadThemes();
                await this.loadLayouts();
                await this.loadStats();
                this.renderFeatures();
                this.renderThemes();
                this.renderLayouts();
                this.applyTheme(this.currentTheme);
                this.applyLayout(this.currentLayout);
                this.bindEvents();
            }

            async loadFeatures() {
                try {
                    const response = await fetch('./features/features.json');
                    const data = await response.json();
                    this.features = data.features || [];
                } catch (error) {
                    console.error('Failed to load features:', error);
                    this.features = [];
                }
            }

            async loadThemes() {
                try {
                    const response = await fetch('./styles/styles.json');
                    const data = await response.json();
                    this.themes = data.themes || [];
                } catch (error) {
                    console.error('Failed to load themes:', error);
                    this.themes = [];
                }
            }

            async loadLayouts() {
                try {
                    const response = await fetch('./layouts/layouts.json');
                    const data = await response.json();
                    this.layouts = data.layouts || [];
                } catch (error) {
                    console.error('Failed to load layouts:', error);
                    this.layouts = [];
                }
            }

            async loadStats() {
                try {
                    const response = await fetch('./history.json');
                    const data = await response.json();
                    document.getElementById('statArchives').textContent = (data.entries || []).length;
                } catch {
                    document.getElementById('statArchives').textContent = '-';
                }

                document.getElementById('statFeatures').textContent = this.features.length;
                document.getElementById('statThemes').textContent = this.themes.length;
                document.getElementById('statLayouts').textContent = this.layouts.length;
            }

            renderFeatures() {
                const container = document.getElementById('featureList');

                if (this.features.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--morpho-text-secondary);">Ê©üËÉΩ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>';
                    return;
                }

                // Group by category
                const groups = {};
                this.features.forEach(f => {
                    const cat = f.category || 'other';
                    if (!groups[cat]) groups[cat] = [];
                    groups[cat].push(f);
                });

                const categories = {
                    'ui': 'UI Enhancements',
                    'accessibility': 'Accessibility',
                    'navigation': 'Navigation',
                    'analytics': 'Analytics',
                    'entertainment': 'Entertainment',
                    'other': 'Other'
                };

                container.innerHTML = Object.entries(groups).map(([cat, features]) => `
                    <div class="feature-group">
                        <div class="feature-group-title">${categories[cat] || cat}</div>
                        ${features.map(feature => {
                    const isEnabled = this.isFeatureEnabled(feature);
                    const isRequired = feature.required;

                    return `
                                <div class="feature-item" data-feature-id="${feature.id}">
                                    <div class="feature-info">
                                        <div class="feature-name">
                                            ${feature.name}
                                            ${isRequired ? '<span class="badge">ÂøÖÈ†à</span>' : ''}
                                            ${feature.author === 'ai' ? '<span class="badge" style="background: linear-gradient(135deg, #22c55e, #10b981);">AIÁîüÊàê</span>' : ''}
                                        </div>
                                        <div class="feature-description">${feature.description}</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" 
                                               data-feature-id="${feature.id}" 
                                               ${isEnabled ? 'checked' : ''} 
                                               ${isRequired ? 'disabled' : ''}>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            `;
                }).join('')}
                    </div>
                `).join('');
            }

            renderThemes() {
                const container = document.getElementById('themeGrid');

                if (this.themes.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--morpho-text-secondary); grid-column: 1 / -1;">„ÉÜ„Éº„Éû„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>';
                    return;
                }

                container.innerHTML = this.themes.map(theme => {
                    const isActive = theme.id === this.currentTheme;
                    const preview = theme.preview || {};

                    return `
            <div class="theme-card ${isActive ? 'active' : ''}" data-theme-id="${theme.id}">
              <div class="theme-preview">
                <div class="theme-color" style="background: ${preview.primary || '#6366f1'}"></div>
                <div class="theme-color" style="background: ${preview.secondary || '#8b5cf6'}"></div>
                <div class="theme-color" style="background: ${preview.background || '#f8fafc'}"></div>
              </div>
              <div class="theme-name">${theme.name}</div>
              <div class="theme-description">${theme.description?.substring(0, 30) || ''}...</div>
            </div>
          `;
                }).join('');
            }

            renderLayouts() {
                const container = document.getElementById('layoutGrid');

                if (this.layouts.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--morpho-text-secondary); grid-column: 1 / -1;">„É¨„Ç§„Ç¢„Ç¶„Éà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü</p>';
                    return;
                }

                container.innerHTML = this.layouts.map(layout => {
                    const isActive = layout.id === this.currentLayout;
                    const preview = layout.preview || {};

                    return `
            <div class="layout-card ${isActive ? 'active' : ''}" data-layout-id="${layout.id}">
              ${isActive ? '<i class="check-icon" data-lucide="check" style="width: 16px; height: 16px;"></i>' : ''}
              <div class="layout-header">
                <div class="layout-name">${layout.name}</div>
                <div class="layout-badge">${layout.mood || 'Standard'}</div>
              </div>
              <div class="layout-description">${layout.description}</div>
              <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem; flex-wrap: wrap;">
                ${preview.gridType ? `
                    <span class="layout-badge" title="Grid Type">
                        <i data-lucide="grid" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;"></i>
                        ${preview.gridType}
                    </span>` : ''}
                ${preview.cardStyle ? `
                    <span class="layout-badge" title="Card Style">
                        <i data-lucide="layers" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;"></i>
                        ${preview.cardStyle}
                    </span>` : ''}
                ${preview.animation ? `
                    <span class="layout-badge" title="Animation">
                        <i data-lucide="play-circle" style="width: 12px; height: 12px; display: inline-block; vertical-align: middle;"></i>
                        ${preview.animation}
                    </span>` : ''}
              </div>
              ${layout.evolution_note ? `<div class="layout-evolution">${layout.evolution_note}</div>` : ''}
              <div class="layout-footer">
                <span>Gen #${layout.generation || '-'}</span>
                <span>${layout.addedDate || ''}</span>
              </div>
            </div>
          `;
                }).join('');

                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }

            isFeatureEnabled(feature) {
                if (feature.required) return true;
                const setting = this.settings.features?.[feature.id];
                return setting !== undefined ? setting : feature.enabled;
            }

            applyTheme(themeId) {
                const existing = document.querySelector('link[href*="/styles/themes/"]');
                if (existing) {
                    existing.href = `./styles/themes/${themeId}.css`;
                }

                // Update active state
                document.querySelectorAll('.theme-card').forEach(card => {
                    card.classList.toggle('active', card.dataset.themeId === themeId);
                });
            }

            applyLayout(layoutId) {
                const layout = this.layouts.find(l => l.id === layoutId);
                if (!layout) return;

                // Update active state in UI
                document.querySelectorAll('.layout-card').forEach(card => {
                    const isNowActive = card.dataset.layoutId === layoutId;
                    card.classList.toggle('active', isNowActive);
                });
            }

            bindEvents() {
                // Feature selection (Toggle switches)
                document.getElementById('featureList').addEventListener('change', (e) => {
                    const checkbox = e.target;
                    const featureId = checkbox.dataset.featureId;
                    if (featureId) {
                        this.settings.features[featureId] = checkbox.checked;
                    }
                });

                // Tab switching
                document.querySelectorAll('.settings-nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const tabId = item.dataset.tab;
                        this.switchTab(tabId);
                    });
                });

                // Search features
                document.getElementById('featureSearch').addEventListener('input', (e) => {
                    this.filterFeatures(e.target.value);
                });

                // Theme selection
                document.getElementById('themeGrid').addEventListener('click', (e) => {
                    const card = e.target.closest('.theme-card');
                    if (card) {
                        this.currentTheme = card.dataset.themeId;
                        this.applyTheme(this.currentTheme);
                    }
                });

                // Layout selection
                document.getElementById('layoutGrid').addEventListener('click', (e) => {
                    const card = e.target.closest('.layout-card');
                    if (card) {
                        this.currentLayout = card.dataset.layoutId;
                        this.applyLayout(this.currentLayout);
                    }
                });

                // Save button
                document.getElementById('btnSave').addEventListener('click', () => {
                    this.settings.theme = this.currentTheme;
                    this.settings.layout = this.currentLayout;
                    this.saveSettings();
                    this.showToast('Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                });

                // Reset button
                document.getElementById('btnReset').addEventListener('click', () => {
                    if (confirm('Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                        localStorage.removeItem('morpho-settings');
                        localStorage.removeItem('morpho-theme');
                        localStorage.removeItem('morpho-layout');
                        this.settings = { features: {}, theme: 'default', layout: 'default' };
                        this.currentTheme = 'default';
                        this.currentLayout = 'default';
                        this.applyTheme('default');
                        this.applyLayout('default');
                        this.renderFeatures();
                        this.renderThemes();
                        this.renderLayouts();
                        this.showToast('Ë®≠ÂÆö„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
                    }
                });

                // Hamburger Menu
                const hamburger = document.getElementById('hamburger');
                const mobileMenu = document.getElementById('mobileMenu');

                if (hamburger && mobileMenu) {
                    hamburger.addEventListener('click', () => {
                        hamburger.classList.toggle('active');
                        mobileMenu.classList.toggle('show');
                        document.body.style.overflow = mobileMenu.classList.contains('show') ? 'hidden' : '';
                    });
                }
            }

            switchTab(tabId) {
                // Update nav items
                document.querySelectorAll('.settings-nav-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.tab === tabId);
                });

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === `tab-${tabId}`);
                });

                // Re-render if needed or run lucide
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }

            filterFeatures(query) {
                const q = query.toLowerCase();
                const items = document.querySelectorAll('.feature-item');
                items.forEach(item => {
                    const name = item.querySelector('.feature-name').textContent.toLowerCase();
                    const desc = item.querySelector('.feature-description').textContent.toLowerCase();
                    const isVisible = name.includes(q) || desc.includes(q);
                    item.style.display = isVisible ? 'flex' : 'none';
                });

                // Hide empty groups
                document.querySelectorAll('.feature-group').forEach(group => {
                    const hasVisibleItems = Array.from(group.querySelectorAll('.feature-item'))
                        .some(item => item.style.display !== 'none');
                    group.style.display = hasVisibleItems ? 'block' : 'none';
                });
            }

            showToast(message) {
                const toast = document.getElementById('toast');
                document.getElementById('toastMessage').textContent = message;
                toast.classList.add('show');

                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Spin animation
        const style = document.createElement('style');
        style.textContent = '@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }';
        document.head.appendChild(style);

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            const settings = new SettingsManager();
            settings.init();
        });
    </script>
</body>

</html>